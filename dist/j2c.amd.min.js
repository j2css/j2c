define(function(){"use strict";function e(e,n){for(var r in n)A.call(n,r)&&(!r.indexOf("$")||r in e||(e[r]=n[r]));return e}function n(e,n){var r,l,t=[];for(l in n)if(A.call(n,l))for(r in e)A.call(e,r)&&t.push(e[r]+n[l]);return t}function r(e){for(var n,r=[],l=[],t=0;n=Z.exec(e);)switch(n[0]){case"(":t++;break;case")":t--;break;case",":if(t)break;r.push(n.index)}for(n=r.length;n--;)l.unshift(e.slice(r[n]+1)),e=e.slice(0,r[n]);return l.unshift(e),l}function l(e,r){for(var l,t,i=[],a=[];t=O.exec(e);)"&"==t[0]&&i.push(t.index);for(t=i.length;t--;)a.unshift(e.slice(i[t]+1)),e=e.slice(0,i[t]);for(a.unshift(e),1===a.length&&a.unshift(""),l=[a[0]],t=1;t<a.length;t++)l=n(l,n(r,[a[t]]));return l.join(",")}function t(e){return function n(r){if(w.call(r)===z)for(var l=0;l<r.length;l++)n(r[l]);else e(r)}}function i(e){for(;S.length<e;)S+=Math.floor(4294967296*Math.random()).toString(36);var n="_"+S.slice(0,e);return S=S.slice(e),n}function a(e){return"-"+e.toLowerCase()}function u(e,n,r,l,t){var i,c,o;if(null!=l)switch(w.call(l=l.valueOf())){case z:for(i=0;i<l.length;i++)u(e,n,r,l[i],t);break;case v:for(i in l)if(A.call(l,i))if(c=l[i],i.indexOf("$")!==-1)for(o in i=i.split("$"))A.call(i,o)&&u(e,n,r+i[o],c,t);else u(e,n,r+i,c,t);break;default:if(!r)return n.raw(l);i=r.replace(/[A-Z]/g,a),!t||"animation-name"!=i&&"animation"!=i||(l=l.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),n.decl(i,l)}}function c(e,n,t,i,a,o){var f,s,p,h;switch(w.call(i)){case v:for(f in i)if(A.call(i,f))if(s=i[f],t.length>0&&/^\*?[-\w$]+$/.test(f))if(p||(p=1,n.rule(t)),f.indexOf("$")!==-1)for(h in f=f.split("$"))A.call(f,h)&&u(e,n,f[h],s,a);else u(e,n,f,s,a);else if("@"===f.charAt(0))p=0,e.atrules(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*([\s\S]*?)\s*$/.exec(f)||[f,"@","",""],s,t,a,o);else{if(p=0,""===f){n._rule(),n.err("Invalid selector ''");continue}c(e,n,t.length>0&&t.indexOf(",")+f.indexOf(",")!==-2?(h=r(t),r(a?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f).map(function(e){return e.indexOf("&")!==-1?l(e,h):h.map(function(n){return n+e}).join(",")}).join(",")):f.indexOf("&")!==-1?l(a?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f,[t]):t+(a?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f),s,a,o+1)}break;case z:for(f=0;f<i.length;f++)c(e,n,t,i[f],a,o);break;case x:t.length&&n.rule(t),n.raw(i)}}function o(e,n){var r;return n?e:{init:function(){r="",e.init()},done:function(){return r&&(e._rule(),r=""),e.done()},atrule:function(n,l,t,i){r&&(e._rule(),r=""),e.atrule(n,l,t,i)},_atrule:function(n){r&&(e._rule(),r=""),e._atrule(n)},rule:function(n){n!==r&&(r&&e._rule(),e.rule(n),r=n)},_rule:function(){r&&(e._rule(),r="")}}}function f(e){return function(n,r,l,i,a,u,o){if("global"!==l[2]||l[3])if("local"!==l[2]||l[3])if("adopt"===l[2]&&l[3]){if(!u||o)return r.err("@adopt global or nested: "+l[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(l[3]))return r.err("bad adopter "+JSON.stringify(l[3])+" in "+l[0]);var f=[];t(function(e,n){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(n=e+"")?f.push(n.replace(/\./g,"")):r.err("bad adoptee "+JSON.stringify(e)+" in "+l[0])})(i),f.length&&(n.localize(l[3]=l[3].replace(/\./g,"")),n.names[l[3]]+=" "+f.join(" "))}else u&&"keyframes"===l[2]&&l[3]&&(l[3]=l[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,n.localizeReplacer)),e(n,r,l,i,a,u,o);else c(n,r,a,i,1,o);else c(n,r,a,i,0,o)}}function s(e){return function(n,r,l,a,o,f,s){if("namespace"!==l[2]&&"import"!==l[2]&&"charset"!==l[2]||l[3])if("font-face"===l[2]||"page"===l[2]||"viewport"===l[2])t(function(e){r.atrule(l[1],l[2],l[3],"decl"),u(n,r,"",e,f),r._atrule()})(a);else if(("media"===l[2]||"supports"===l[2])&&l[3]||"keyframes"===l[2]){if("keyframes"===l[2]&&""===l[3]){if(""===o)return void r.err("Unexpected anonymous @keyframes out of selector");l[3]="_"+i(8),r.rule(o),r.decl("animation-name",l[3])}r.atrule(l[1],l[2],l[3],"rule"),c(n,r,"keyframes"==l[2]?"":o,a,f,s+1),r._atrule()}else e(n,r,l,a,o,f,s);else t(function(e){r.atrule(l[1],l[2],e)})(a)}}function p(e,n,r){n.err("Unsupported at-rule: "+r[0])}function h(e,n,r,l){l.init();try{e(r,l,"",n,1,0)}catch(e){l.err(e instanceof Error?e.stack:""+e)}return l.done()}function g(n,r,l,t,i,a){function o(e){return A.call(f,e)||(f[e]=n+e+r),f[e].match(/^\S+/)}for(var f={},s={atrules:l,names:f,localize:o,localizeReplacer:function(e,n,r,l,t){return n||r||l+o(t)}},p={ns:function(e){var n="__"+e.replace(/\W+/g,"_")+"_";return A.call(t,n)||(t[n]=g(n,r,l,t,i,a)),t[n]},names:f,prefix:n,suffix:r,sheet:function(e){return h(c,e,s,i[0])},inline:function(e){return h(u,e,s,i[1])}},d=a.length;d--;)e(p,a[d]);return p}function d(n){n=n||{};var r,l,a=[{init:function(){r=[],l=[]},done:function(e){if(0!=l.length)throw new Error("j2c error(s): "+JSON.stringify(l,null,2)+" in context:\n"+r.join(""));return e?r:r.join("")},err:function(e){l.push(e),r.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){r.push(e,"\n")},atrule:function(e,n,l,t){r.push(e,l&&" ",l,t?" {\n":";\n")},_atrule:function(){r.push("}\n")},rule:function(e){r.push(e," {\n")},_rule:function(){r.push("}\n")},decl:function(e,n){r.push(e,":",n,";\n")}}],u=[o],c=[],f=[],s=i(7),p={},h=y;w.call(n.plugins)===z&&t(function(e){if(w.call(e)!==v)throw new Error("bad plugin, object expected, got "+w.call(e));w.call(e.filter)===b&&u.push(e.filter),w.call(e.atrule)===b&&c.push(e.atrule),w.call(e.sink)===b&&(a=e.sink()),w.call(e.set)===v&&f.push(e.set)})(n.plugins),w.call(n.suffix)===x&&(s=n.suffix),w.call(n.suffix)===m&&(s=i(n.suffix));for(var d=c.length;d--;)h=c[d](h);for(a[1]=a[1]||{init:a[0].init,done:a[0].done,raw:a[0].raw,err:a[0].err,decl:a[0].decl},d=0;d<2;d++)for(var _=u.length;_--;)a[d]=k(e(u[_](a[d],!!d),a[d]));return k(g("",s,h,p,a,f))}var _={},w=_.toString,z=w.call([]),m=w.call(0),v=w.call(_),x=w.call(""),b=w.call(w),A=_.hasOwnProperty,k=Object.freeze||function(e){return e},Z=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,O=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,S="",y=f(s(p));return d});