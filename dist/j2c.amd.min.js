define(function(){"use strict";function e(e,n){for(var r in n)A.call(n,r)&&(!r.indexOf("$")||r in e||(e[r]=n[r]));return e}function n(e,n){var r,t,l=[];for(t in n)if(A.call(n,t))for(r in e)A.call(e,r)&&l.push(e[r]+n[t]);return l}function r(e){for(var n,r=[],t=[],l=0;n=k.exec(e);)switch(n[0]){case"(":l++;break;case")":l--;break;case",":if(l)break;r.push(n.index)}for(n=r.length;n--;)t.unshift(e.slice(r[n]+1)),e=e.slice(0,r[n]);return t.unshift(e),t}function t(e,r){for(var t,l,a=[],i=[];l=S.exec(e);)"&"==l[0]&&a.push(l.index);for(l=a.length;l--;)i.unshift(e.slice(a[l]+1)),e=e.slice(0,a[l]);for(i.unshift(e),1===i.length&&i.unshift(""),t=[i[0]],l=1;l<i.length;l++)t=n(t,n(r,[i[l]]));return t.join(",")}function l(e){return function n(r){if(w.call(r)===z)for(var t=0;t<r.length;t++)n(r[t]);else e(r)}}function a(e){for(;j.length<e;)j+=Math.floor(4294967296*Math.random()).toString(36);var n="_"+j.slice(0,e);return j=j.slice(e),n}function i(e){return"-"+e.toLowerCase()}function u(e,n,r,t,l){var a,c,o;if(null!=t)switch(w.call(t=t.valueOf())){case z:for(a=0;a<t.length;a++)u(e,n,r,t[a],l);break;case b:for(a in t)if(A.call(t,a))if(c=t[a],a.indexOf("$")!==-1)for(o in a=a.split("$"))A.call(a,o)&&u(e,n,r+a[o],c,l);else u(e,n,r+a,c,l);break;default:if(!r)return n.raw(t);a=r.replace(/[A-Z]/g,i),!l||"animation-name"!=a&&"animation"!=a||(t=t.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),n.decl(a,t)}}function c(e,n,l,a,i,o){var f,s,p,h;switch(w.call(a)){case b:for(f in a)if(A.call(a,f))if(s=a[f],l.length>0&&/^\*?[-\w$]+$/.test(f))if(p||(p=1,n.rule(l)),f.indexOf("$")!==-1)for(h in f=f.split("$"))A.call(f,h)&&u(e,n,f[h],s,i);else u(e,n,f,s,i);else if("@"===f.charAt(0))p=0,e.atrules(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*([\s\S]*?)\s*$/.exec(f)||[f,"@","",""],s,l,i,o);else{if(p=0,""===f){n._rule(),n.err("Invalid selector ''");continue}c(e,n,l.length>0&&(/,/.test(l)||/,/.test(f))?(h=r(l),r(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f).map(function(e){return/&/.test(e)?t(e,h):h.map(function(n){return n+e}).join(",")}).join(",")):/&/.test(f)?t(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f,[l]):l+(i?f.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):f),s,i,o+1)}break;case z:for(f=0;f<a.length;f++)c(e,n,l,a[f],i,o);break;case m:l.length&&n.rule(l),n.raw(a)}}function o(e,n){var r;return n?e:{init:function(){r="",e.init()},done:function(){return r&&(e._rule(),r=""),e.done()},atrule:function(n,t,l,a){r&&(e._rule(),r=""),e.atrule(n,t,l,a)},_atrule:function(n){r&&(e._rule(),r=""),e._atrule(n)},rule:function(n){n!==r&&(r&&e._rule(),e.rule(n),r=n)},_rule:function(){r&&(e._rule(),r="")}}}function f(e){return function(n,r,t,a,i,u,o){if(t[3]||"global"!==t[2])if(t[3]||"local"!==t[2])if(t[3]&&"adopt"===t[2]){if(!u||o)return r.err("@adopt global or nested: "+t[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(t[3]))return r.err("bad adopter "+JSON.stringify(t[3])+" in "+t[0]);var f=[];l(function(e,n){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(n=e+"")?f.push(n.replace(/\./g,"")):r.err("bad adoptee "+JSON.stringify(e)+" in "+t[0])})(a),f.length&&(n.localize(t[3]=t[3].replace(/\./g,"")),n.names[t[3]]+=" "+f.join(" "))}else u&&t[3]&&"keyframes"===t[2]&&(t[3]=t[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,n.localizeReplacer)),e(n,r,t,a,i,u,o);else c(n,r,i,a,1,o);else c(n,r,i,a,0,o)}}function s(e){return function(n,r,t,a,i,o,f){t[3]||"namespace"!==t[2]&&"import"!==t[2]&&"charset"!==t[2]?"font-face"===t[2]||"page"===t[2]||"viewport"===t[2]?l(function(e){r.atrule(t[1],t[2],t[3],"decl"),u(n,r,"",e,o),r._atrule()})(a):!t[3]||"keyframes"!==t[2]&&"media"!==t[2]&&"supports"!==t[2]?e(n,r,t,a,i,o,f):(r.atrule(t[1],t[2],t[3],"rule"),c(n,r,"keyframes"==t[2]?"":i,a,o,f+1),r._atrule()):l(function(e){r.atrule(t[1],t[2],e)})(a)}}function p(e,n,r){n.err("Unsupported at-rule: "+r[0])}function h(e,n,r,t){t.init();try{e(r,t,"",n,1,0)}catch(e){t.err(e instanceof Error?e.stack:""+e)}return t.done()}function g(n,r,t,l,a,i){function o(e){return A.call(f,e)||(f[e]=n+e+r),f[e].match(/^\S+/)}for(var f={},s={atrules:t,names:f,localize:o,localizeReplacer:function(e,n,r,t,l){return n||r||t+o(l)}},p={ns:function(e){var n="__"+e.replace(/\W+/g,"_")+"_";return A.call(l,n)||(l[n]=g(n,r,t,l,a,i)),l[n]},names:f,prefix:n,suffix:r,sheet:function(e){return h(c,e,s,a[0])},inline:function(e){return h(u,e,s,a[1])}},_=i.length;_--;)e(p,i[_]);return p}function _(n){n=n||{};var r,t,i=[{init:function(){r=[],t=[]},done:function(e){if(0!=t.length)throw new Error("j2c error(s): "+JSON.stringify(t,null,2)+" in context:\n"+r.join(""));return e?r:r.join("")},err:function(e){t.push(e),r.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){r.push(e,"\n")},atrule:function(e,n,t,l){r.push(e,t&&" ",t,l?" {\n":";\n")},_atrule:function(){r.push("}\n")},rule:function(e){r.push(e," {\n")},_rule:function(){r.push("}\n")},decl:function(e,n){r.push(e,":",n,";\n")}}],u=[o],c=[],f=[],s=a(7),p={},h=O;w.call(n.plugins)===z&&l(function(e){if(w.call(e)!==b)throw new Error("bad plugin, object expected, got "+w.call(e));w.call(e.filter)===x&&u.push(e.filter),w.call(e.atrule)===x&&c.push(e.atrule),w.call(e.sink)===x&&(i=e.sink()),w.call(e.set)===b&&f.push(e.set)})(n.plugins),w.call(n.suffix)===m&&(s=n.suffix),w.call(n.suffix)===v&&(s=a(n.suffix));for(var _=c.length;_--;)h=c[_](h);for(i[1]=i[1]||{init:i[0].init,done:i[0].done,raw:i[0].raw,err:i[0].err,decl:i[0].decl},_=0;_<2;_++)for(var d=u.length;d--;)i[_]=Z(e(u[d](i[_],!!_),i[_]));return Z(g("",s,h,p,i,f))}var d={},w=d.toString,z=w.call([]),v=w.call(0),b=w.call(d),m=w.call(""),x=w.call(w),A=d.hasOwnProperty,Z=Object.freeze||function(e){return e},k=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,S=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,j="",O=f(s(p));return _});