"use strict";function defaults(e,n){for(var r in n)own.call(n,r)&&(!r.indexOf("$")||r in e||(e[r]=n[r]));return e}function cartesian(e,n){var r,t,l=[];for(t in n)if(own.call(n,t))for(r in e)own.call(e,r)&&l.push(e[r]+n[t]);return l}function splitSelector(e){for(var n,r=[],t=[],l=0;n=selectorTokenizer.exec(e);)switch(n[0]){case"(":l++;break;case")":l--;break;case",":if(l)break;r.push(n.index)}for(n=r.length;n--;)t.unshift(e.slice(r[n]+1)),e=e.slice(0,r[n]);return t.unshift(e),t}function ampersand(e,n){for(var r,t,l=[],a=[];t=ampersandTokenizer.exec(e);)"&"==t[0]&&l.push(t.index);for(t=l.length;t--;)a.unshift(e.slice(l[t]+1)),e=e.slice(0,l[t]);for(a.unshift(e),1===a.length&&a.unshift(""),r=[a[0]],t=1;t<a.length;t++)r=cartesian(r,cartesian(n,[a[t]]));return r.join(",")}function flatIter(e){return function n(r){if(type.call(r)===ARRAY)for(var t=0;t<r.length;t++)n(r[t]);else e(r)}}function randIdentifier(e){for(;chars.length<e;)chars+=Math.floor(4294967296*Math.random()).toString(36);var n="_"+chars.slice(0,e);return chars=chars.slice(e),n}function decamelize(e){return"-"+e.toLowerCase()}function declarations(e,n,r,t,l){var a,i,c;if(null!=t)switch(type.call(t=t.valueOf())){case ARRAY:for(a=0;a<t.length;a++)declarations(e,n,r,t[a],l);break;case OBJECT:for(a in t)if(own.call(t,a))if(i=t[a],a.indexOf("$")!==-1)for(c in a=a.split("$"))own.call(a,c)&&declarations(e,n,r+a[c],i,l);else declarations(e,n,r+a,i,l);break;default:if(!r)return n.raw(t);a=r.replace(/[A-Z]/g,decamelize),!l||"animation-name"!=a&&"animation"!=a||(t=t.split(",").map(function(n){return n.replace(/^\s*(?:(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*))/,e.localizeReplacer)}).join(",")),n.decl(a,t)}}function rules(e,n,r,t,l,a){var i,c,o,s;switch(type.call(t)){case OBJECT:for(i in t)if(own.call(t,i))if(c=t[i],r.length>0&&/^\*?[-\w$]+$/.test(i))if(o||(o=1,n.rule(r)),i.indexOf("$")!==-1)for(s in i=i.split("$"))own.call(i,s)&&declarations(e,n,i[s],c,l);else declarations(e,n,i,c,l);else if("@"===i.charAt(0))o=0,e.atrules(e,n,/^(.(?:-[\w]+-)?([_A-Za-z][-\w]*))\b\s*([\s\S]*?)\s*$/.exec(i)||[i,"@","",""],c,r,l,a);else{if(o=0,""===i){n._rule(),n.err("Invalid selector ''");continue}rules(e,n,r.length>0&&r.indexOf(",")+i.indexOf(",")!==-2?(s=splitSelector(r),splitSelector(l?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i).map(function(e){return e.indexOf("&")!==-1?ampersand(e,s):s.map(function(n){return n+e}).join(",")}).join(",")):i.indexOf("&")!==-1?ampersand(l?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i,[r]):r+(l?i.replace(/("(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\/)|:global\(\s*(\.-?[_A-Za-z][-\w]*)\s*\)|(\.)(-?[_A-Za-z][-\w]*)/g,e.localizeReplacer):i),c,l,a+1)}break;case ARRAY:for(i=0;i<t.length;i++)rules(e,n,r,t[i],l,a);break;case STRING:r.length&&n.rule(r),n.raw(t)}}function closeSelectors(e,n){var r;return n?e:{init:function(){r="",e.init()},done:function(){return""!==r&&(e._rule(),r=""),e.done()},atrule:function(n,t,l,a){""!==r&&(e._rule(),r=""),e.atrule(n,t,l,a)},_atrule:function(n){""!==r&&(e._rule(),r=""),e._atrule(n)},rule:function(n){n!==r&&(""!==r&&e._rule(),e.rule(n),r=n)},_rule:function(){r&&(e._rule(),r="")}}}function modulesAtRules(e){return function(n,r,t,l,a,i,c){if("global"!==t[2]||t[3])if("local"!==t[2]||t[3])if("adopt"===t[2]&&t[3]){if(!i||c)return r.err("@adopt global or nested: "+t[0]);if(!/^\.?[_A-Za-z][-\w]*$/.test(t[3]))return r.err("bad adopter "+JSON.stringify(t[3])+" in "+t[0]);var o=[];flatIter(function(e,n){null!=e&&/^\.?[_A-Za-z][-\w]*(?:\s+\.?[_A-Za-z][-\w]*)*$/.test(n=e+"")?o.push(n.replace(/\./g,"")):r.err("bad adoptee "+JSON.stringify(e)+" in "+t[0])})(l),o.length&&(n.localize(t[3]=t[3].replace(/\./g,"")),n.names[t[3]]+=" "+o.join(" "))}else i&&"keyframes"===t[2]&&t[3]&&(t[3]=t[3].replace(/(var\([^)]+\))|:?global\(\s*([_A-Za-z][-\w]*)\s*\)|()(-?[_A-Za-z][-\w]*)/,n.localizeReplacer)),e(n,r,t,l,a,i,c);else rules(n,r,a,l,1,c);else rules(n,r,a,l,0,c)}}function standardAtRules(e){return function(n,r,t,l,a,i,c){if("namespace"!==t[2]&&"import"!==t[2]&&"charset"!==t[2]||t[3])if("font-face"===t[2]||"page"===t[2]||"viewport"===t[2])flatIter(function(e){r.atrule(t[1],t[2],t[3],"decl"),declarations(n,r,"",e,i),r._atrule()})(l);else if(("media"===t[2]||"supports"===t[2])&&t[3]||"keyframes"===t[2]){if("keyframes"===t[2]&&""===t[3]){if(""===a)return void r.err("Unexpected anonymous @keyframes out of selector");t[3]=randIdentifier(8),r.rule(a),r.decl("animation-name",t[3])}r.atrule(t[1],t[2],t[3],"rule"),rules(n,r,"keyframes"==t[2]?"":a,l,i,c+1),r._atrule()}else e(n,r,t,l,a,i,c);else flatIter(function(e){r.atrule(t[1],t[2],e)})(l)}}function unsupportedAtRule(e,n,r){n.err("Unsupported at-rule: "+r[0])}function invoke(e,n,r,t){t.init();try{e(r,t,"",n,1,0)}catch(e){t.err(e instanceof Error?e.stack:""+e)}return t.done()}function makeInstance(e,n,r,t,l,a){function i(r){return own.call(c,r)||(c[r]=e+r+n),c[r].match(/^\S+/)}for(var c={},o={atrules:r,names:c,localize:i,localizeReplacer:function(e,n,r,t,l){return n||r||t+i(l)}},s={ns:function(e){var i="__"+e.replace(/\W+/g,"_")+"_";return own.call(t,i)||(t[i]=makeInstance(i,n,r,t,l,a)),t[i]},names:c,prefix:e,suffix:n,sheet:function(e){return invoke(rules,e,o,l[0])},inline:function(e){return invoke(declarations,e,o,l[1])}},u=a.length;u--;)defaults(s,a[u]);return s}function J2c(e){e=e||{};var n,r,t=[{init:function(){n=[],r=[]},done:function(e){if(0!=r.length)throw new Error("j2c error(s): "+JSON.stringify(r,null,2)+" in context:\n"+n.join(""));return e?n:n.join("")},err:function(e){r.push(e),n.push("/* +++ ERROR +++ "+e+" */\n")},raw:function(e){n.push(e,"\n")},atrule:function(e,r,t,l){n.push(e,t&&" ",t,l?" {\n":";\n")},_atrule:function(){n.push("}\n")},rule:function(e){n.push(e," {\n")},_rule:function(){n.push("}\n")},decl:function(e,r){n.push(e,":",r,";\n")}}],l=[closeSelectors],a=[],i=[],c=randIdentifier(7),o={},s=baselineAtRules;type.call(e.plugins)===ARRAY&&flatIter(function(e){if(type.call(e)!==OBJECT)throw new Error("bad plugin, object expected, got "+type.call(e));type.call(e.filter)===FUNCTION&&l.push(e.filter),type.call(e.atrule)===FUNCTION&&a.push(e.atrule),type.call(e.sink)===FUNCTION&&(t=e.sink()),type.call(e.set)===OBJECT&&i.push(e.set)})(e.plugins),type.call(e.suffix)===STRING&&(c=e.suffix),type.call(e.suffix)===NUMBER&&(c=randIdentifier(e.suffix));for(var u=a.length;u--;)s=a[u](s);for(t[1]=t[1]||{init:t[0].init,done:t[0].done,raw:t[0].raw,err:t[0].err,decl:t[0].decl},u=0;u<2;u++)for(var f=l.length;f--;)t[u]=freeze(defaults(l[f](t[u],!!u),t[u]));return freeze(makeInstance("",c,s,o,t,i))}var emptyObject={},type=emptyObject.toString,ARRAY=type.call([]),NUMBER=type.call(0),OBJECT=type.call(emptyObject),STRING=type.call(""),FUNCTION=type.call(type),own=emptyObject.hasOwnProperty,freeze=Object.freeze||function(e){return e},selectorTokenizer=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,ampersandTokenizer=/&|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g,chars="",baselineAtRules=modulesAtRules(standardAtRules(unsupportedAtRule));module.exports=J2c;